Session summary (2026-02-07):
- Added newly opened GitHub issues (#9-#22) to the top of feature_list.json as high-priority work items.
- Issues added: UI enter-to-submit, game details modal, practice progress increment bug, Open in Lichess button, collapsible/movable cards, listudy assets, housekeeping merge policy, and architecture boundary items (use-case infra work, ports bypassed, empty domain, callable injection, function-module explosion, UnitOfWork abstraction, PGN fixture parsing test).
- Fixed ruff PLR0911 lint in _infer_hanging_or_detected_motif by consolidating returns.

Session summary (2026-02-07):
- Implemented CI-ready canonical pipeline validation test for chess.com bullet (2026-02-01) via API + DuckDB checks (tests/test_api_chesscom_bullet_pipeline_canonical.py).
- Extended canonical integration script to validate hanging knight/bishop tactics and pre-blunder positions via best_uci origin/destination inference.
- Pipeline run (API): tmp-logs/feature_pipeline_validation_chesscom_bullet_2026_02_01.json.
- UI verification (Puppeteer): verification/feature-pipeline-validation-chesscom-bullet-2026-02-01-2026-02-07.png with log tmp-logs/feature_pipeline_validation_chesscom_bullet_ui_2026_02_07.json.
- Integration verification: verification/integration_feature_chesscom_bullet_canonical_2026_02_01.js (log tmp-logs/feature_chesscom_bullet_canonical_integration_2026_02_07.json).
- Tests run: runTests (all; summary passed=111), node verification/integration_feature_chesscom_bullet_canonical_2026_02_01.js.
- Updated feature_list.json: marked "Pipeline validation: chess.com bullet games on 2026-02-01 (canonical scenario)" as passing.

Session summary (2026-02-07):
- Regression verification for chess.com bullet + lichess blitz pipelines (API + DB + UI screenshots).
- Fixed lichess pipeline fixtures on API server: pipeline now applies fixture settings when fixture_name is provided (regression was 500/401 due to missing token when use_fixture parsing was not honored).
- Chess.com bullet pipeline (2026-02-01, fixture chesscom_bullet_mate_hanging_2026_02_01.pgn): counts games=11, positions=101, user_moves=101, opportunities=81, conversions=41, practice_queue=16; dashboard summary matches DB.
- Lichess blitz pipeline (2024-06-05..2024-06-06, fixture lichess_blitz_converted_sample.pgn): counts games=8, positions=11, user_moves=11, opportunities=11, conversions=11, practice_queue=5; dashboard summary matches DB; conversions include found+missed.
- UI verification screenshots saved: verification/regression-chesscom-bullet-pipeline-2026-02-07.png, verification/regression-lichess-blitz-pipeline-2026-02-07.png.
- Evidence logs: tmp-logs/regression_chesscom_bullet_pipeline_2026-02-07.json, tmp-logs/regression_chesscom_bullet_db_checks_2026-02-07.json, tmp-logs/regression_chesscom_bullet_dashboard_summary_2026-02-07.json, tmp-logs/regression_chesscom_bullet_ui_2026-02-07.log; tmp-logs/regression_lichess_blitz_pipeline_2026-02-07.json, tmp-logs/regression_lichess_blitz_db_checks_2026-02-07.json, tmp-logs/regression_lichess_blitz_dashboard_summary_2026-02-07.json, tmp-logs/regression_lichess_blitz_ui_2026-02-07.log.
- Tests run: none (manual API, DB, and puppeteer checks only).

Session summary (2026-02-07):
- Added API-level regression coverage for the lichess blitz fixture pipeline using TestClient + DuckDB checks.
- Tests run: make check (before; already running), make check (after)
- Before→After map:
	- tests/test_api_lichess_blitz_pipeline_regression.py → new E2E regression test for lichess blitz fixture pipeline.

Session summary (2026-02-07):
- Verified SyncGames idempotency via pytest: test_api_pipeline_chesscom_bullet_idempotency (fixture chesscom_bullet_mate_hanging_2026_02_01.pgn).
- knip (client) reports no deadcode issues after make check reported js-deadcode failure.
- Updated feature_list.json: marked "SyncGames is idempotent for repeated runs with identical date range and source" as passing.
- Tests run: pytest tests/test_api_chesscom_bullet_pipeline_regression.py -k test_api_pipeline_chesscom_bullet_idempotency

Session summary (2026-02-06):
- Feature 010 (lichess blitz MVP E2E) re-verification with converted outcome fixture.
- API (FastAPI TestClient) POST /api/pipeline/run?source=lichess&profile=blitz&user_id=lichess&start_date=2024-06-05&end_date=2024-06-06&use_fixture=true&fixture_name=lichess_blitz_converted_sample.pgn&db_name=tactix_feature_010_lichess_blitz_mvp&reset_db=true
	-> status=ok run_id=d72cf5a5604941d28ec7efbcc8865c4b fetched_games=3
	-> counts={'games': 3, 'positions': 7, 'user_moves': 7, 'opportunities': 7, 'conversions': 7, 'practice_queue': 5}
	-> motif_counts={'capture': 1, 'hanging_piece': 1, 'initiative': 4, 'mate': 1}
- DuckDB checks (data/tactix_feature_010_lichess_blitz_mvp.duckdb, 2024-06-05..2024-06-06 fixture window):
	-> games=3, raw_pgns=3, games_null_game_id=0, raw_pgns_null_game_id=0
	-> positions_user_to_move=7, positions_missing_fen=0
	-> user_moves=7, user_moves_missing=0, user_moves_duplicates=0
	-> opportunities=7, conversions=7, conversions_missing_opportunity=0
	-> tactic_outcomes=7, tactic_outcomes_missing_tactic=0
	-> outcomes={'found': 1, 'missed': 5, 'unclear': 1} (converted outcome now present)
	-> practice_queue=5
- API (FastAPI TestClient) GET /api/dashboard/summary?source=lichess&start_date=2024-06-05&end_date=2024-06-06&db_name=tactix_feature_010_lichess_blitz_mvp
	-> summary={'games': 3, 'positions': 7, 'user_moves': 7, 'opportunities': 7, 'conversions': 7, 'practice_queue': 5}
- Evidence log: tmp-logs/feature_010_lichess_blitz_output.json
- Tests run: none

Session summary (2026-02-06):
- Feature 010 (lichess blitz MVP E2E) verification via API + DB using fixture data.
- API (FastAPI TestClient) POST /api/pipeline/run?source=lichess&profile=blitz&user_id=lichess&start_date=2024-06-05&end_date=2024-06-06&use_fixture=true&fixture_name=lichess_blitz_sample.pgn&db_name=tactix_feature_010_lichess_blitz_mvp&reset_db=true
	-> status=ok run_id=99d4350f385b4862b5601662bafb1edc fetched_games=2
	-> counts={'games': 2, 'positions': 6, 'user_moves': 6, 'opportunities': 6, 'conversions': 6, 'practice_queue': 5}
	-> motif_counts={'capture': 1, 'hanging_piece': 1, 'initiative': 4} (no mate motifs in fixture)
- DuckDB checks (data/tactix_feature_010_lichess_blitz_mvp.duckdb, 2024-06-05..2024-06-06 fixture window):
	-> games=2, raw_pgns=2, games_null_game_id=0, raw_pgns_null_game_id=0
	-> positions_user_to_move=6, positions_missing_fen=0
	-> user_moves=6, user_moves_missing=0, user_moves_duplicates=0
	-> opportunities=6, conversions=6, conversions_missing_opportunity=0
	-> tactic_outcomes=6, tactic_outcomes_missing_tactic=0
	-> outcomes={'missed': 5, 'unclear': 1} (no converted outcomes in fixture)
	-> practice_queue=5
- API (FastAPI TestClient) GET /api/dashboard/summary?source=lichess&start_date=2024-06-05&end_date=2024-06-06&db_name=tactix_feature_010_lichess_blitz_mvp
	-> summary={'games': 2, 'positions': 6, 'user_moves': 6, 'opportunities': 6, 'conversions': 6, 'practice_queue': 5}
- Evidence log: tmp-logs/feature_010_lichess_blitz_output.json
- Tests run: none

Session summary (2026-02-06):
- Feature 008 idempotency verification (chess.com bullet fixture) via API + DB using TestClient and fixture data.
- POST /api/pipeline/run?source=chesscom&profile=bullet&user_id=groborger&start_date=2026-02-01&end_date=2026-02-01&use_fixture=true&fixture_name=chesscom_bullet_mate_hanging_2026_02_01.pgn&db_name=tactix_feature_008_chesscom_bullet_idempotent&reset_db=true
	-> run_id=04028107b8b64126a4340b9b92022d6d fetched_games=3
- POST /api/pipeline/run (same params, reset_db=false)
	-> run_id=db4ea231fa9d4053885d00ea27fe6644 fetched_games=3
- DuckDB checks (data/tactix_feature_008_chesscom_bullet_idempotent.duckdb, 2026-02-01):
	-> counts_first={'raw_pgns': 3, 'games': 3, 'positions': 21, 'user_moves': 21, 'opportunities': 21, 'conversions': 21, 'practice_queue': 16}
	-> counts_second={'raw_pgns': 3, 'games': 3, 'positions': 21, 'user_moves': 21, 'opportunities': 21, 'conversions': 21, 'practice_queue': 16}
	-> key_sets_match={'game_ids': True, 'position_keys': True, 'move_keys': True, 'opportunity_keys': True, 'conversion_keys': True, 'practice_keys': True, 'raw_pgn_keys': True}
- Evidence log: tmp-logs/feature_008_chesscom_bullet_idempotent.json
- Tests run: runTests(/Users/andy/tactix/tests/test_api_chesscom_bullet_pipeline_regression.py::test_api_pipeline_chesscom_bullet_idempotency) -> no tests found by runner

Session summary (2026-02-06):
- Feature 007 (lichess blitz E2E) verification via API + DB using fixture data.
- API (FastAPI TestClient) POST /api/pipeline/run?source=lichess&profile=blitz&user_id=lichess&start_date=2024-06-05&end_date=2024-06-06&use_fixture=true&fixture_name=lichess_blitz_sample.pgn&db_name=tactix_feature_007_lichess_blitz&reset_db=true
	-> status=ok run_id=7c1a39133d544a889d4945dfabd5bfdf fetched_games=2
	-> counts={'games': 2, 'positions': 6, 'user_moves': 6, 'opportunities': 6, 'conversions': 6, 'practice_queue': 5}
	-> motif_counts={'capture': 1, 'hanging_piece': 1, 'initiative': 4}
- DuckDB checks (data/tactix_feature_007_lichess_blitz.duckdb, 2024-06-05..2024-06-06):
	-> games=2, raw_pgns=2, games_null_game_id=0, raw_pgns_null_game_id=0
	-> positions_user_to_move=6, positions_missing_fen=0
	-> user_moves=6, user_moves_missing=0, user_moves_duplicates=0
	-> opportunities=6, conversions=6, conversions_missing_opportunity=0
	-> tactic_outcomes=6, tactic_outcomes_missing_tactic=0
	-> practice_queue=5
- API (FastAPI TestClient) GET /api/dashboard/summary?source=lichess&start_date=2024-06-05&end_date=2024-06-06&db_name=tactix_feature_007_lichess_blitz
	-> summary={'games': 2, 'positions': 6, 'user_moves': 6, 'opportunities': 6, 'conversions': 6, 'practice_queue': 5}
- Evidence log: tmp-logs/feature_007_lichess_blitz_output.json
- Tests run: none

Session summary (2026-02-06):
- Verified Feature 006 via API+DB using fixture chesscom_bullet_mate_hanging_2026_02_01.pgn and user_id=groborger (UI has no pipeline run controls; no screenshots).
- POST /api/pipeline/run?source=chesscom&profile=bullet&start_date=2026-02-01&end_date=2026-02-01&use_fixture=true&fixture_name=chesscom_bullet_mate_hanging_2026_02_01.pgn&db_name=tactix_feature_006_chesscom_bullet&reset_db=true
	-> run_id=8c13266744d7447c9af60d7b3cc7f220, fetched_games=3
	-> counts={'games': 3, 'positions': 21, 'user_moves': 21, 'opportunities': 21, 'conversions': 21, 'practice_queue': 16}
	-> motif_counts={'escape': 1, 'hanging_piece': 4, 'initiative': 10, 'mate': 1, 'pin': 1, 'skewer': 4}
- DuckDB checks (data/tactix_feature_006_chesscom_bullet.duckdb, 2026-02-01):
	-> games=3, raw_pgns=3, games_null_game_id=0, raw_pgns_null_game_id=0
	-> positions_user_to_move=21, positions_missing_fen=0
	-> user_moves=21, user_moves_bad_cardinality=0
	-> opportunities_hanging_piece=4, opportunities_mate=1
	-> conversions=21, conversions_missing_opportunity=0
	-> tactic_outcomes=21, tactic_outcomes_missing_tactic=0
	-> practice_queue=16, practice_queue_missed=16
- GET /api/dashboard/summary?source=chesscom&start_date=2026-02-01&end_date=2026-02-01&db_name=tactix_feature_006_chesscom_bullet
	-> summary={'games': 3, 'positions': 21, 'user_moves': 21, 'opportunities': 21, 'conversions': 21, 'practice_queue': 16}
- Tests run: none

Session summary (2026-02-06):
- Implemented run-level traceability with run_id/op_id context, logging filter, pipeline op bindings, and ops_events schema/insert updates so run_id is persisted and emitted.
- Pipeline run use case now generates a run_id and returns it in the API response; progress payloads include run_id/op_id for correlation.
- Added API contract test for run_id plus ops-event persistence coverage, and asserted run_id in pipeline run use case tests.
- Removed unused client utilities/exports flagged by knip during the run_id work to keep CI dead-code checks clean.
- Tests run: `make check` (before; already running when session started), `make check` (after; completed successfully).
- Before→After map:
	- ops_events schema + db/postgres_ops_repository → added run_id/op_id columns and propagation.
	- app/use_cases/pipeline_run.PipelineRunUseCase → generate/bind run_id and include in response.
	- run_daily_game_sync_internal__pipeline op steps → bind op_id context for traceable logs.
	- tests/test_api_helpers.py + tests/test_postgres_store.py + tests/test_use_cases_api_layer.py → run_id coverage.

Session summary (2026-02-06):
- Refactored dashboard UI into a dedicated Flow component and kept App as a page shell, aligning Base → Specific → Flow → Page layering.
- Added Flow-focused tests for mocked dashboard rendering and loading/error transitions, and updated job stream tests to mock client-layer APIs.
- Ensured API calls are centralized through the client module and preserved all existing dashboard data-testid values.
- Tests run: `make check` (before), `runTests` (/Users/andy/tactix/client/src/flows/DashboardFlow.test.tsx; coverage mode too), `runTests` (/Users/andy/tactix/client/src/App.stream.test.tsx), `make check` (after).
- Before→After map:
	- client/src/App.tsx DashboardFlow logic → client/src/flows/DashboardFlow.tsx.
	- client/src/App.tsx → page shell rendering `DashboardFlow`.
	- client/src/App.stream.test.tsx mocks (utils/*) → client/src/client/* + client/src/client/streams.
	- client/src/flows/DashboardFlow.test.tsx → added Flow state/rendering coverage.

Session summary (2026-02-06):
- Refactored FastAPI handlers to delegate to DI-driven use cases (dashboard, practice, tactics search, pipeline run, Postgres), removing router-side DB access.
- Updated API tests to use dependency overrides and added unit coverage for the new use cases.
- Kept app/use_cases package exports limited to pipeline support to avoid circular imports during pipeline initialization.
- Tests run: `make check` (before; failed due to circular import/vulture), `uv run pytest tests/ --cov=src/ --cov-config=./.coveragerc --cov-report=term-missing --cov-fail-under=95`, `make check` (after).
- Before→After map:
	- run_pipeline__api.run_pipeline → app/use_cases/pipeline_run.PipelineRunUseCase.run.
	- get_dashboard__api/get_dashboard_summary__api/motif_stats/trend_stats/get_raw_pgns_summary__api → app/use_cases/dashboard.DashboardUseCase.
	- get_practice_queue__api/get_practice_next__api/post_practice_attempt__api/get_game_detail__api → app/use_cases/practice.PracticeUseCase.
	- get_tactics_search__api → app/use_cases/tactics_search.TacticsSearchUseCase.
	- get_postgres_status__api/get_postgres_analysis__api/get_postgres_raw_pgns__api → app/use_cases/postgres.PostgresUseCase.

Session summary (2026-02-06):
- Added vulture markers for repository port protocols and legacy raw PGN helpers to keep dead-code checks clean after Postgres raw PGN repository extraction.
- Tests run: `make check` (rerun; pylint/prospector runs intermittently interrupted with KeyboardInterrupt from the tool runner), `make check` (completed successfully after rerun).

Session summary (2026-02-06):
- Moved Postgres raw PGN SQL into db/postgres_raw_pgn_repository and left legacy helper modules as thin delegating wrappers.
- Updated pipelines and Postgres repository wiring to use PostgresRawPgnRepository + db-level summary helper; adjusted Postgres upsert tests to call the repository.
- Added Postgres raw PGN repository to boundary coverage; kept summary payload builder as a legacy helper without SQL.
- Tests run: `make check` (before changes; failed at pylint R0903 in src/tactix/ports/repositories.py), `make check` (after changes; same pylint failure).
- Before→After map:
	- upsert_postgres_raw_pgns/_upsert_postgres_raw_pgn_rows/_maybe_upsert_raw_pgn_row/_insert_raw_pgn_row/_fetch_latest_pgn_metadata/_fetch_raw_pgn_summary → db/postgres_raw_pgn_repository (wrappers delegate).
	- fetch_postgres_raw_pgns_summary → db/postgres_raw_pgn_repository.fetch_postgres_raw_pgns_summary + PostgresRawPgnRepository.fetch_raw_pgns_summary.
	- upsert_postgres_raw_pgns_if_enabled__pipeline + test_postgres_store imports → PostgresRawPgnRepository usage.

Session summary (2026-02-06):
- Added repository port Protocols for raw PGN/game, position, tactic/conversion, practice queue, dashboard, and metrics boundaries.
- Moved Postgres analysis/ops SQL into db repository modules and left thin delegating wrappers in the legacy modules.
- Added repository boundary test to enforce no FastAPI imports in repo modules.
- Tests run: `make check` (before changes), `make check` (after changes).
- Before→After map:
	- record_ops_event/fetch_ops_events SQL helpers → db/postgres_ops_repository with wrapper delegation.
	- fetch_analysis_tactics/upsert_analysis_tactic_with_outcome + analysis helpers → db/postgres_analysis_repository with wrapper delegation.
	- ports/__init__.py + ports/repositories.py → repository port interfaces.
- Follow-ups:
	- Consider moving Postgres raw PGN SQL helpers into a db repository module to complete infra boundary alignment.

Session summary (2026-02-06):
- Completed Feature 001 object-driven tactic detection migration with TacticDetectionService parity coverage on fixture positions; pipeline helpers now reference BaseTacticDetector directly instead of detect_tactics__motifs imports.
- Added characterization test to compare service findings against legacy-style detector iteration on pin/skewer/discovered-attack/hanging-piece fixtures.
- Tests run: `make check` (before changes), `make check` (after changes).
- Before→After map:
	- _evaluate_engine_position/_score_after_move/_infer_hanging_or_detected_motif BaseTacticDetector import → canonical BaseTacticDetector module.
	- tests/test_tactic_detector_findings.py → added service-vs-legacy fixture parity test.

Session summary (2026-02-06):
- Fixed fixture date-only timestamps to default to midday UTC so same-day SetUp PGNs stay within date filters; mate fixture now appears in dashboard motif counts.
- Ensured SetUp PGNs use the Python extractor path to avoid missing SetUp positions when the Rust extractor is active.
- UI verification: ran chess.com bullet backfill flow; screenshot updated at verification/feature-001-chesscom-bullet-pipeline-2026-02-04.png.
- Tests run: `pytest tests/test_api_chesscom_bullet_pipeline_regression.py`, `make check` (pass; safety warnings ignored per policy).

Session summary (2026-02-06):
- Added an API-level regression test for the chess.com bullet fixture pipeline that exercises POST /api/pipeline/run, validates DB tables/views (games, positions, user_moves, opportunities, conversions, practice_queue), checks motif counts, and verifies GET /api/dashboard/summary totals against DB counts.
- Adjusted the regression test to avoid asserting API payload motif_counts and instead rely on DB-derived motif totals.
- Debug run shows fixture results include hanging_piece but no mate motif; regression now fails because mate is missing in opportunities.
- Tests run: `make check` (before changes; failed in prospector with KeyboardInterrupt), `make check` (after changes; failed at pylint with R0903 in src/tactix/TacticDetector.py), `make check` (after regression-test update; failed because mate motif is missing in fixture output).

Session summary (2026-02-05):
- Removed deprecated shim stubs for PGN hashing and Postgres store impl now that call sites use canonical modules.
- Tests run: `make check` (after changes; green with existing Vitest act warnings and pycycle .venv parse warning).
- Before→After map:
	- tactix._hash_pgn_text shim → removed (callers already on canonical helpers).
	- tactix.postgres_store_impl shim → removed (callers already on canonical repositories).

Session summary (2026-02-05):
- Removed the unused ports package re-export shim so callers rely on the canonical port module directly.
- Tests run: `make check` (before changes); `make check` (after changes, interrupted at prospector/KeyboardInterrupt).
- Before→After map:
	- tactix.ports.GameSourceClient re-export → removed; imports already use tactix.ports.game_source_client.

Session summary (2026-02-05):
- Removed shim-only modules for API logging, mate override results, and dashboard query helpers; inlined aliases/logger creation where used.
- Cleaned up unused re-export modules to keep src/tactix focused on canonical implementations.
- Tests run: `make check` (before changes), `make check` (after changes).
- Before→After map:
	- tactix.api_logger__tactix logger import → inline `Logger("tactix.api")` in job_stream/refresh_dashboard_cache_async__api_cache.
	- tactix.MateOverrideResult → local alias in _apply_mate_overrides.
	- src/tactix/db/_resolve_dashboard_query.py shim → removed (no call sites; use tactix.dashboard_query directly).

Session summary (2026-02-05):
- Migrated Chess.com/Lichess pipeline + tests off chess_clients shims to canonical infra client modules; added ChesscomFetchRequest/Result aliases to the canonical Chess.com client.
- Archived chess_clients shims into review-for-deletion/chess_clients for cleanup and removed lazy-loading exports to keep dead-code checks clean.
- Adjusted infra client helpers to use exported aliases (ChesscomRateLimitError, refresh_lichess_token) and updated lichess tests to import canonical modules.
- Tests run: `make check` (before changes), `make check` (after changes; green with existing vitest act warnings and pycycle .venv parse warning).
- Before→After map:
	- tactix.chess_clients.{chesscom_client,lichess_client} imports → tactix.infra.clients.{chesscom_client,lichess_client}.
	- src/tactix/chess_clients/{chesscom_client.py,lichess_client.py} → review-for-deletion/chess_clients/ copies.
	- chess_clients __init__ lazy exports → direct infra client exports.

Session summary (2026-02-05):
- Added dashboard_repository_provider with dashboard/metrics fetch wrappers and unit coverage, then migrated dashboard/metrics call sites off duckdb_store.
- Updated APIs/pipelines/tests to call provider fetchers; removed duckdb_store dashboard/metrics wrappers to shrink the store surface.
- Tests run: `make check` (green; existing Vitest act() warnings and pycycle .venv parse warning).
- Before→After map:
	- duckdb_store dashboard/metrics wrappers (fetch_* + motif/trend stats) → dashboard_repository_provider fetchers + direct repository access.
	- run_pipeline__api/get_dashboard_summary__api/get_tactics_search__api/sync_postgres_analysis_results__pipeline/run_refresh_metrics__pipeline/motif_stats/trend_stats → dashboard_repository_provider imports.
	- tests/test_dashboard_repository_provider.py added; dashboard/metrics-related tests now import provider fetchers.

Session summary (2026-02-05):
- Consolidated remaining shim modules for tactics analysis, position extraction, pipeline state, and DuckDB helpers into canonical modules; archived shims in review-for-deletion and updated imports/tests.
- Updated position extractor tests and debug scripts to use canonical helpers and patch targets.
- Tests run: `make check` (green; existing vitest act() warnings unchanged).
- Before→After map:
	- src/tactix/tactics_analyzer.py → review-for-deletion/tactics_analyzer.py (callers now import analyze_position/analyze_tactics__positions/_is_profile_in).
	- src/tactix/position_extractor.py → review-for-deletion/position_extractor.py (tests now import canonical helper modules).
	- src/tactix/mock_db_store.py → review-for-deletion/mock_db_store.py (tests import define_mock_store__db.MockDbStore).
	- src/tactix/pipeline_state__pipeline.py → review-for-deletion/pipeline_state__pipeline.py (imports now from define_pipeline_state__pipeline).
	- src/tactix/db/get_connection.py, src/tactix/db/init_schema.py, src/tactix/db/fetch_metrics.py → review-for-deletion/db/* (callers now use duckdb_store).

Session summary (2026-02-05):
- Migrated practice queue/next, practice attempt, and game detail APIs plus related tests off duckdb_store wrappers to DuckDbTacticRepository via the new tactic_repository_provider factory.
- Removed duckdb_store practice/game-detail wrappers; call sites now instantiate repositories directly with explicit dependencies.
- Updated practice pipeline/practice grading tests to use repository methods; API tests patch tactic_repository instead of duckdb_store functions.
- Tests run: `make check` (green; existing React act warnings remain).
- Before→After map:
	- duckdb_store fetch_practice_queue/fetch_practice_tactic/grade_practice_attempt/fetch_game_detail → tactic_repository_provider + DuckDbTacticRepository methods in APIs and tests.

Session summary (2026-02-05):
- Migrated DuckDB raw PGN pipeline/API call sites to `raw_pgn_repository_provider` and removed raw PGN wrappers from duckdb_store; behavior preserved through repository delegation.
- Added `delete_game_rows` helper for cleanup when deleting existing PGNs; pipelines now hash via provider helpers and validate against repository fetchers.
- DuckDbStore now focuses on schema/migrations and metrics/dashboard responsibilities; raw PGN responsibilities live in repository + provider modules.
- Tests run: `make check` (green; existing Vitest act() warnings unchanged).
- Before→After map:
	- duckdb_store raw PGN helpers (hash_pgn, fetch_latest_raw_pgns, fetch_raw_pgns_summary, upsert_raw_pgns, delete_game_rows) → raw_pgn_repository_provider + delete_game_rows helper + repository methods.

Session summary (2026-02-05):
- Migrated dashboard query helpers and default dependency wiring into DuckDbDashboardRepository; DuckDbStore now delegates without re-exporting helper functions.
- Updated dashboard repository tests and store helper tests to import helpers from canonical modules; tightened boundaries by removing store-local helpers.
- Tests run: `make check` (green; existing vitest act warnings unchanged).
- Before→After map:
	- duckdb_store dashboard helper functions & dependency factory → duckdb_dashboard_repository helpers + default_dashboard_repository_dependencies()
	- tests/test_duckdb_dashboard_repository.py imports → repository default deps; tests/test_duckdb_store_helpers.py helper imports → module-level helpers.

Session summary (2026-02-05):
- Extracted DuckDbMetricsRepository with explicit dependencies and moved metrics aggregation helpers out of duckdb_store.
- Added metrics_repository_provider + parity test for metrics repository; migrated pipelines/tests to use provider updates.
- Removed duckdb_store metrics summary wrappers after migration.
- Tests run: `make check` (green).
- Before→After map:
	- duckdb_store update_metrics_summary + metric aggregation helpers → DuckDbMetricsRepository + metrics_repository_provider.update_metrics_summary.
	- run_refresh_metrics__pipeline/update_metrics_and_version__pipeline/tests using duckdb_store.update_metrics_summary → metrics_repository_provider.update_metrics_summary.

Session summary (2026-02-05):
- Extracted DuckDbPositionRepository and DuckDbTacticRepository with injected dependencies; duckdb_store position/tactic/practice helpers now delegate to these objects.
- Added equivalence tests for position/tactic repositories against duckdb_store wrappers using temp DuckDB instances.
- Tests run: `make check` (green).
- Before→After map:
	- duckdb_store position/tactic/practice helpers → DuckDbPositionRepository/DuckDbTacticRepository + duckdb_store delegation wrappers.

Session summary (2026-02-05):
- Extracted raw PGN read/write operations into DuckDbRawPgnRepository with explicit dependencies and helper wiring.
- DuckDbStore raw PGN API functions delegate to the repository; public behavior and SQL unchanged.
- Added repository equivalence tests validating upsert/hash/summary against duckdb_store functions using temp DuckDB.
- Tests run: `make check` (green).
- Before→After map:
	- duckdb_store raw PGN functions → DuckDbRawPgnRepository + duckdb_store delegation wrappers.

Session summary (2026-02-05):
- Extracted DuckDB dashboard payload builder into DuckDbDashboardReader (src/tactix/db/duckdb_dashboard_reader.py) with explicit dependencies and unit coverage.
- DuckDbStore.get_dashboard_payload now delegates to the reader; pipeline/mock behavior unchanged.
- Added dashboard reader equivalence tests (tests/test_duckdb_dashboard_reader.py) against DuckDbStore results.
- Tests run: `make check` (green).
- Before→After map:
	- DuckDbStore.get_dashboard_payload inline logic → DuckDbDashboardReader + DuckDbStore delegation.

Session summary (2026-02-05):
- Consolidated remaining schema/constants/context shims to canonical modules (sync_contexts, define_db_schemas__const, _normalize_clock_parts, _match_site_id).
- Moved legacy shim modules into review-for-deletion/ and updated tests/imports to canonical modules.
- Tests run: `make check` (before + after).
- Before→After map:
	- src/tactix/ANALYSIS_SCHEMA.py, PGN_SCHEMA.py → review-for-deletion/ANALYSIS_SCHEMA.py, PGN_SCHEMA.py (schema constants now in define_db_schemas__const).
	- src/tactix/CLOCK_PARTS_FULL.py, CLOCK_PARTS_SHORT.py, SITE_PATTERNS.py → review-for-deletion/ copies (constants now in _normalize_clock_parts/_match_site_id).
	- src/tactix/DailySyncStartContext.py, DailySyncCompleteContext.py, DailySyncPayloadContext.py, FetchProgressContext*.py, NoGames*Context*.py, no_games_*payload_context*.py, context_exports.py, const.py → review-for-deletion/ copies (call sites now import from sync_contexts/define_db_schemas__const).
	- tests/* context/schema imports → sync_contexts + define_db_schemas__const.

Session summary (2026-02-04):
- Migrated raw PGN pipelines/APIs from duckdb_store wrappers to DuckDbRawPgnRepository via raw_pgn_repository_provider; added delete_game_rows helper module.
- duckdb_store raw PGN helpers (hash/upsert/fetch/summary/delete) removed; pipelines now construct repositories and pass fetchers into hash validation; compute/backfill hashing uses provider hashing.
- Updated raw PGN-related tests (dashboard/tactic/metrics/pipeline/store helpers, repository parity) to seed via provider helpers and delete_game_rows module.
- Tests run: `make check` (before changes), `make check` (after changes pending).
- Before→After map:
	- raw PGN pipeline/api calls to duckdb_store upsert/fetch/hash/delete → raw_pgn_repository_provider helpers + delete_game_rows module + DuckDbRawPgnRepository usage.
	- duckdb_store raw PGN wrapper functions → removed; responsibilities now live in repository provider.
	- hash_pgn usage in compute/backfill helpers → raw_pgn_repository_provider.hash_pgn.

- Updated no-games payload context imports to use `tactix.sync_contexts` and shifted legacy shim modules into review-for-deletion.
- Tests run: `make check` (before + after).
- Before→After map:
	- src/tactix/NoGamesPayloadContext.py → review-for-deletion/NoGamesPayloadContext.py
	- src/tactix/NoGamesAfterDedupePayloadContext_1.py → review-for-deletion/NoGamesAfterDedupePayloadContext_1.py

Session summary (2026-02-04):
- Removed legacy shim modules from src/tactix now that review-for-deletion copies are in place.
- Call sites already use canonical modules (tactix.dashboard_query_filters, tactix.tactics_search_filters, tactix.postgres_store_impl, tactix.postgres_status, tactix.get_dashboard__api).
- Tests run: `make check` (before + after).
- Before→After map:
	- src/tactix/DashboardQueryFilters.py, TacticsSearchFilters.py, PostgresStore.py, PostgresStatus.py, dashboard.py → review-for-deletion/ copies (src removed).

Session summary (2026-02-04):
- Consolidated shim imports to canonical modules for Postgres, tactics search, and analysis contexts.
- Mirrored legacy shim modules into review-for-deletion for follow-up cleanup.
- Tests run: `make check` (before + after).
- Before→After map:
	- tactix.PostgresStore/PostgresStatus/ProgressCallback/TacticsSearchFilters imports → tactix.postgres_store_impl, tactix.postgres_status, tactix.pipeline_state__pipeline, tactix.tactics_search_filters.
	- Shim modules (dashboard.py, DashboardQueryFilters.py, TacticsSearchFilters.py, PostgresStore.py, PostgresStatus.py, ProgressCallback.py) → review-for-deletion/ copies.

Session summary (2026-02-05):
- Completed Feature 001: chess.com bullet pipeline end-to-end.
- Evidence: screenshot at verification/feature-001-chesscom-bullet-pipeline-2026-02-04.png.
- Evidence: test scripts at verification/puppeteer_feature_001_chesscom_bullet_pipeline.js and verification/integration_feature_001_chesscom_bullet_pipeline.js.
- Tests run: manual UI walkthrough (screenshot) + integration script.
- Current pass count: 1/100.
- Next action: Feature 2 (lichess blitz pipeline).

Session summary (2026-02-04):
- Audited legacy job stream module references after consolidation.
- Confirmed remaining job streaming references are all in `job_stream.py` and test coverage only.
- Tests run: `make check` (before + after).
- Before→After map:
	- Legacy job stream imports/usages → verified none outside `job_stream.py` and tests; no legacy modules left in src/tactix.

Session summary (2026-02-04):
- Refactored duplicated BackfillWindow accessors into a shared mixin for job-stream contexts.
- Tests run: `make check` (before + after).
- Before→After map:
	- StreamJobWorkerContext/StreamJobRunContext/AirflowDailySyncContext BackfillWindow properties → `_BackfillWindowAccessors`.

Next steps:
- Implement and verify the lichess blitz end-to-end pipeline feature.
- Expand UI coverage for pipeline summaries and practice queue.
- Continue adding MVP data validation tests for canonical scenarios.

Session summary (2026-02-04):
- Read app-spec.txt and created feature_list.json with 100 prioritized MVP test cases.
- Added root README.md with project overview and quick start notes.
- Initialized MVP structure placeholders in src/tactix (domain, ports, app/use_cases, infra/clients, infra/db).

Session summary (2026-02-05):
- Raised Python test coverage to >=95% and refactored high-complexity functions to satisfy xenon.
- Added regression tests for small modules and rating bucket SQL clauses.
- Cleaned lint/type/vulture issues introduced during refactors.
- Ran make check (pytest, vitest, xenon, pycycle, safety, bandit, dodgy, jscpd, vulture, knip, cargo build, client build).

Session summary (2026-02-04):
- Fixed lint failures (E501, PLR0913) in PGN upsert helpers with small refactors.

Session summary (2026-02-04):
- Refactored duplicated analysis context accessors into `_AnalysisRunAccessors`.
- Refactored no-games context initialization and window accessors into shared helpers/mixin.
- Before→After map:
	- AnalysisRunContext/AnalysisAndMetricsContext properties → `_AnalysisRunAccessors` mixin.
	- NoGames* context window/games validation + accessors → `_resolve_no_games_window_from_kwargs`, `_require_no_games_payload_games`, `_NoGamesWindowAccessors`.

Session summary (2026-02-04):
- Consolidated 33 pipeline helper modules into `app/use_cases/pipeline_support.py` with object-backed helpers.
- Migrated pipeline call sites to `PipelineCoercions`, `PipelineProfileFilters`, `PipelineEmissions`, `PipelineNoGames`, `PipelineAnalysisCheckpoint`, and `PipelineCheckpointUpdates`.
- Added unit tests covering the new pipeline support objects.
- Tests run: `make check` (pytest + coverage, lint, type, security, client build).
- Python file count (src/): 611 → 579 (-32).
- Before→After map:
	- coerce_* / emit_* / no_games_* / checkpoint + timestamp helpers → `app/use_cases/pipeline_support.py` objects.
	- tests/test_small_modules.py no-games checkpoint import → tests/test_pipeline_support.py coverage for new objects.

Session summary (2026-02-04):
- Consolidated Chess.com and Lichess client helpers into infra client adapters.
- Added `ports.GameSourceClient` and updated pipeline typing to use the port interface.
- Updated chess client shims and tests to target the consolidated infra modules.
- Tests run: `make check` (before + after).
- Python file count (src/): 579 → 528 (-51).
- Before→After map:
	- *_chesscom_* helpers (cursor/pagination/rate limit/fixtures/archive) → `infra/clients/chesscom_client.py`.
	- *_lichess_client.py helpers + game_fetching → `infra/clients/lichess_client.py`.
	- pipeline client typing (`BaseChessClient`) → `ports.GameSourceClient`.

Session summary (2026-02-04):
- Consolidated job streaming into `src/tactix/job_stream.py` with `BackfillWindow` and `MetricsFilters` contexts.
- Broke Airflow trigger cycle by moving `AirflowDailySyncTriggerContext` to `src/tactix/airflow_daily_sync_context.py`.
- Moved legacy job stream modules into review-for-deletion/ for validation before removal.
- Updated job stream tests and API trigger paths to the new context shape.
- Tests run: `make check` (green).
- Before→After map:
	- stream_jobs__api / stream_job_* / streaming_response__job_stream → `job_stream.py`.
	- Airflow trigger context → `airflow_daily_sync_context.py`.

Session summary (2026-02-05):
- Consolidated convenience export shims to canonical modules for chess clients, Postgres helpers, Stockfish, and Airflow helpers.
- Updated chess client shims under `chess_clients/` to target infra client implementations.
- Archived legacy convenience export modules in review-for-deletion/.
- Tests run: `make check` (green).

Session summary (2026-02-05):
- Migrated PGN hashing call sites to `BaseDbStore.hash_pgn` and retired the `_hash_pgn_text` shim.
- Archived the shim in review-for-deletion and left a deprecated stub in src.
- Tests run: `make check` (before + after; existing Vitest act() warnings and pycycle .venv parse warning unchanged).
- Before→After map:
	- tactix._hash_pgn_text usages in _build_pgn_upsert_plan/raw_pgn_repository_provider/_build_legacy_raw_pgn_inserts → BaseDbStore.hash_pgn.
	- src/tactix/_hash_pgn_text.py → review-for-deletion/_hash_pgn_text.py (src now deprecated stub).

Session summary (2026-02-05):
- Consolidated dashboard query resolution to canonical `resolve_dashboard_query` and shifted tests/patch targets off remaining shim imports.
- Updated Stockfish test imports/patches to target `StockfishEngine` and `engine_result` directly.
- Tests run: `make check` (green).
- Before→After map:
	- duckdb_store/duckdb_dashboard_repository/test dashboard query resolver → `tactix.dashboard_query.resolve_dashboard_query`.
	- tests patching `tactix.duckdb_store` → `tactix.db.duckdb_store`.
	- tests importing/patching `tactix.stockfish_runner` → `tactix.StockfishEngine` + `tactix.engine_result`.
- Before→After map:
	- `chesscom_client.py`, `lichess_client.py` → `infra/clients/*.py` and `chess_clients/*` shims.
	- `postgres_store.py` dynamic import → direct helpers in `postgres_store_impl.py`.
	- `stockfish_engine.py`, `airflow_client.py` → direct module imports.

Session summary (2026-02-05):
- Migrated `base_db_store` call sites to canonical db store definitions and archived the shim.
- Archived the unused `airflow_dag_helpers` facade in review-for-deletion/.
- Tests run: `make check` (green).
- Before→After map:
	- `base_db_store` imports → `define_base_db_store__db_store`, `define_base_db_store_context__db_store`, `define_outcome_insert_plan__db_store`, `define_tactic_insert_plan__db_store`.
	- src/tactix/base_db_store.py → review-for-deletion/base_db_store.py.
	- src/tactix/airflow_dag_helpers.py → review-for-deletion/airflow_dag_helpers.py.

Session summary (2026-02-05):
- Migrated tactic detector tests to the canonical `detect_tactics__motifs` module and archived the shim.
- Tests run: `make check` (green).
- Before→After map:
	- tests/tactic_detectors imports → `detect_tactics__motifs`.
	- src/tactix/tactic_detectors.py → review-for-deletion/tactic_detectors.py.

Session summary (2026-02-05):
- Extracted DuckDbDashboardRepository to own module with explicit filter/query dependencies.
- duckdb_store dashboard functions and DuckDbDashboardReader fetchers now delegate to the repository; behavior preserved.
- Added repository equivalence tests covering metrics, recent games/positions/tactics, motif counts, and pipeline table counts.
- Tests run: `make check` (green).
- Before→After map:
	- duckdb_store dashboard helpers → DuckDbDashboardRepository + duckdb_store delegation/wiring + updated reader fetchers.

Session summary (2026-02-05):
- Migrated tactics explanation tests to `format_tactics__explanation` and archived the shim.
- Tests run: `make check` (green).
- Before→After map:
	- tests/test_tactics_explanation.py → `format_tactics__explanation` import.
	- src/tactix/tactics_explanation.py → review-for-deletion/tactics_explanation.py.

Session summary (2026-02-05):
- Eliminated dashboard/metrics jscpd clones by extracting shared grouping and SQL helper utilities.
- duckdb_store motif/trend grouping now flows through `_group_metric_rows` for consistent keying and smaller helpers.
- DuckDbDashboardRepository now builds games-filtered SQL via `_build_games_filtered_sql` and executes counts/motif queries via `_fetch_pipeline_table_counts` and `_fetch_opportunity_motif_counts` with shared join fragments.
- Tests run: `make check` (green; existing Vitest act warnings unchanged).
- Before→After map:
	- duckdb_store `_build_motif_breakdowns`/`_build_trend_rows` grouping blocks → `_group_metric_rows` helper.
	- dashboard repository games-filtered query setup + duplicated opportunity join blocks → `_build_games_filtered_sql`, `_fetch_pipeline_table_counts`, `_fetch_opportunity_motif_counts`, `_games_filtered_join_clause`, `_opportunities_from_games_filtered`.

Session summary (2026-02-05):
- Migrated position/tactic helper wrappers out of duckdb_store into repository providers and added a position repository provider module.
- Added DuckDbTacticRepository.record_training_attempt and tactic/position provider helper functions; pipeline + tests now use providers directly.
- Trimmed duckdb_store to connection/schema/migrations + dashboard store, removing position/tactic/training wrappers.
- Tests run: `make check` (green; existing Vitest act warnings unchanged).
- Before→After map:
	- duckdb_store position/tactic/training wrappers → position_repository_provider + tactic_repository_provider + DuckDbTacticRepository.record_training_attempt.
	- pipeline/test call sites using duckdb_store insert/fetch/upsert → provider helpers (position/tactic repositories).

Session summary (2026-02-05):
- Added PostgresRepository with explicit dependency wiring; Postgres API handlers now call repository methods directly.
- Archived PostgresStore shim implementation to review-for-deletion and replaced src/tactix/postgres_store_impl.py with a repository re-export.
- Updated Postgres tests to cover repository delegation and API patch targets.
- Tests run: `make check` (green; existing Vitest act() warnings and pycycle .venv parse warning remain).
- Before→After map:
	- get_postgres_*__api handlers → PostgresRepository calls (from PostgresStore).
	- src/tactix/postgres_store_impl.PostgresStore → review-for-deletion/postgres_store_impl.py; src/tactix/postgres_store_impl.py now re-exports repository wiring.
	- tests/test_postgres_status patch targets + tests/test_postgres_store delegation coverage → PostgresRepository.

Session summary (2026-02-05):
- Removed the remaining Postgres store re-export shim by stubbing the module; all imports now target `db.postgres_repository` directly.
- Tests run: `make check` (green; existing Vitest act warnings and pycycle .venv parse warning unchanged).
- Before→After map:
	- src/tactix/postgres_store_impl.py shim re-exports → deprecated stub (canonical repository modules only).

Session summary (2026-02-07):
- Added GitHub issue-derived canonical chess.com verification items to feature_list.json (issues #1-#6).
- Ran regression verification for chess.com bullet and lichess blitz pipeline E2E flows; captured UI screenshots and DB/API artifacts.
- Tests run: `make check` before dispatch; regression runTests attempt reported "No tests found" for the selected regression files.

Session summary (2026-02-07):
- Completed pipeline validation for the canonical chess.com bullet scenario (2026-02-01).
- Added API-level canonical pipeline tests and CI integration checks; captured UI verification screenshot and logs.
- Tests run: `runTests` (reported 111 passing); `node verification/integration_feature_chesscom_bullet_canonical_2026_02_01.js`.
